name: CI CD pipeline => Ostad

on:
  push:
    branches:
      - main

jobs:
  setup:
    runs-on: ostad-label

    steps:
      - name: Checkout the repo
        uses: actions/checkout@v4

      - name: Update system
        run: sudo apt update -y

      - name: Install nginx
        run: sudo apt install nginx -y

      - name: Install NVM
        run: |
          export NVM_DIR="$HOME/.nvm"
          if [ ! -d "$NVM_DIR" ]; then
            curl -o- https://raw.githubusercontent.com/nvm-sh/nvm/v0.39.7/install.sh | bash
          fi

      - name: Install latest Node.js & npm using NVM
        run: |
          export NVM_DIR="$HOME/.nvm"
          . "$NVM_DIR/nvm.sh"

          nvm install node
          nvm use node
          nvm alias default node

          node -e "console.log('Running Node.js ' + process.version)"
          npm -v

      - name: Copy test.txt file
        run: cat test.txt
